<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>玉里地政事務所-花蓮縣地段轄區判斷系統</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            /* 禁止選取文字 (除了輸入框) */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* 避免行動端輸入框自動放大 */
        input[type="text"] {
            font-size: 16px !important;
        }
        @media (min-width: 768px) {
            input[type="text"] {
                font-size: 1.125rem !important;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 flex flex-col text-gray-800 overflow-x-hidden">

    <!-- Header -->
    <header class="bg-teal-700 text-white py-6 md:py-8 shadow-md">
        <div class="container mx-auto px-4 text-center">
            <div class="flex items-center justify-center space-x-3 mb-2">
                <i data-lucide="map-pin" class="w-6 h-6 md:w-8 md:h-8 text-yellow-300"></i>
                <h1 class="text-xl md:text-3xl font-bold tracking-wide">玉里地政事務所-花蓮縣地段轄區判斷系統</h1>
            </div>
            <p class="text-teal-100 text-xs md:text-base px-2">
                收錄 2025 年最新地段代碼表，輸入地段、鄉鎮或 <span class="text-yellow-300 font-bold">代碼</span> 即可查詢
            </p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-6 md:py-10 max-w-3xl">
        
        <!-- Search Input Section -->
        <div class="bg-white p-5 md:p-8 rounded-2xl shadow-lg mb-6 md:mb-10">
            <label class="block text-gray-700 text-sm font-bold mb-3 ml-1">
                請輸入地段名、鄉鎮名 或 地段代碼 (如: 0303)
            </label>
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i data-lucide="search" class="h-5 w-5 text-gray-400"></i>
                </div>
                <input
                    type="text"
                    id="searchInput"
                    class="block w-full pl-12 pr-4 py-3 md:py-4 border border-gray-300 rounded-xl leading-5 bg-gray-50 placeholder-gray-400 focus:outline-none focus:bg-white focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition duration-150 ease-in-out select-text"
                    placeholder="輸入地段、代碼或鄉鎮..."
                    style="-webkit-user-select: text; user-select: text;"
                />
            </div>
            
            <!-- Quick Tags (Scrollable on small screens) -->
            <div class="mt-4">
                <div class="flex items-center text-xs text-gray-500 mb-2">
                    <i data-lucide="help-circle" class="w-3 h-3 mr-1"></i> 查詢範例：
                </div>
                <div class="flex flex-wrap gap-2 overflow-x-auto pb-1">
                    <button onclick="setSearch('玉璞')" class="whitespace-nowrap px-3 py-1.5 bg-teal-50 text-teal-700 rounded-full text-xs hover:bg-teal-100 transition border border-teal-100 active:scale-95">玉璞</button>
                    <button onclick="setSearch('0303')" class="whitespace-nowrap px-3 py-1.5 bg-orange-50 text-orange-700 rounded-full text-xs hover:bg-orange-100 transition border border-orange-100 active:scale-95">代碼 0303</button>
                    <button onclick="setSearch('春日')" class="whitespace-nowrap px-3 py-1.5 bg-teal-50 text-teal-700 rounded-full text-xs hover:bg-teal-100 transition border border-teal-100 active:scale-95">春日</button>
                    <button onclick="setSearch('0701')" class="whitespace-nowrap px-3 py-1.5 bg-orange-50 text-orange-700 rounded-full text-xs hover:bg-orange-100 transition border border-orange-100 active:scale-95">代碼 0701</button>
                    <button onclick="setSearch('神社')" class="whitespace-nowrap px-3 py-1.5 bg-teal-50 text-teal-700 rounded-full text-xs hover:bg-teal-100 transition border border-teal-100 active:scale-95">神社</button>
                    <button onclick="setSearch('0802')" class="whitespace-nowrap px-3 py-1.5 bg-orange-50 text-orange-700 rounded-full text-xs hover:bg-orange-100 transition border border-orange-100 active:scale-95">代碼 0802</button>
                </div>
            </div>
        </div>

        <!-- Results Container -->
        <div id="resultsContainer" class="hidden space-y-6 fade-in-up">
            <!-- Content will be injected here via JS -->
        </div>

        <!-- Default View -->
        <div id="defaultContainer" class="text-center py-6 md:py-10 fade-in-up">
            
            <div id="suggestionBox" class="hidden bg-orange-50 text-orange-800 p-4 rounded-xl inline-block text-left w-full max-w-sm border border-orange-100 shadow-sm mb-8 mx-auto">
                <p class="flex items-center gap-2 font-bold mb-1"><i data-lucide="info" class="w-4 h-4"></i> 提示：</p>
                <p class="text-sm" id="suggestionText"></p>
            </div>

            <div id="emptyStateIcon" class="text-gray-400">
                <i data-lucide="building-2" class="w-12 h-12 md:w-16 md:h-16 mx-auto mb-4 opacity-20"></i>
                <p class="text-sm md:text-base">輸入地段名或代碼開始查詢</p>
            </div>
            
            <!-- Jurisdiction Reference Table -->
            <div class="mt-12 text-left">
                <h3 class="text-lg font-bold text-gray-700 mb-6 border-l-4 border-teal-500 pl-3">全縣轄區對照表 (2025 更新)</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="officeList">
                    <!-- Office list will be generated by JS -->
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-400 py-8 px-4 text-center text-sm mt-auto">
        <p class="font-medium">玉里地政便民查詢系統</p>
        <p class="mt-2 text-xs opacity-60">資料來源：各地政事務所 114 年段別代碼表</p>
    </footer>

    <script>
        // --- 封鎖右鍵與開發者工具 ---
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if(e.key === 'F12' || (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key)) || (e.ctrlKey && ['U','S'].includes(e.key))) e.preventDefault();
        });

        // --- 資料設定 ---
        const offices = [
            {
                id: 'yuli',
                name: '玉里地政事務所',
                areas: ['玉里鎮', '瑞穗鄉', '富里鄉', '卓溪鄉'],
                address: '花蓮縣玉里鎮莊敬路18號',
                phone: '03-888-3171',
                mapLink: 'https://google.com/maps?q=玉里地政事務所',
                website: 'https://www.yuli.gov.tw/',
                color: 'bg-orange-600',
                lightColor: 'bg-orange-50',
                borderColor: 'border-orange-200'
            },
            {
                id: 'hualien',
                name: '花蓮地政事務所',
                areas: ['花蓮市', '吉安鄉', '新城鄉', '秀林鄉', '壽豐鄉'],
                address: '花蓮市府後路23號',
                phone: '03-822-5135',
                mapLink: 'https://www.google.com/maps/search/花蓮地政事務所',
                website: 'https://www.hl-land.gov.tw/',
                color: 'bg-blue-600',
                lightColor: 'bg-blue-50',
                borderColor: 'border-blue-200'
            },
            {
                id: 'fenglin',
                name: '鳳林地政事務所',
                areas: ['鳳林鎮', '光復鄉', '豐濱鄉', '萬榮鄉'],
                address: '花蓮縣鳳林鎮光華路1號',
                phone: '03-876-1103',
                mapLink: 'https://google.com/maps?q=鳳林地政事務所',
                website: 'https://flland.hl.gov.tw/',
                color: 'bg-green-600',
                lightColor: 'bg-green-50',
                borderColor: 'border-green-200'
            },
        ];

        // 模擬資料庫 (擴充)
        const sectionDatabase = [
            { n: '玉璞', c: '0303', a: '玉里鎮' },
            { n: '春日', c: '0701', a: '玉里鎮' },
            { n: '神社', c: '0802', a: '玉里鎮' },
            { n: '光復', c: '1102', a: '光復鄉' },
            { n: '吉安', c: '2105', a: '吉安鄉' },
            { n: '新城', c: '3101', a: '新城鄉' },
            { n: '壽豐', c: '4101', a: '壽豐鄉' },
            { n: '瑞穗', c: '0502', a: '瑞穗鄉' },
            { n: '富里', c: '0601', a: '富里鄉' },
            { n: '玉興', c: '0304', a: '玉里鎮' }
        ];

        const searchInput = document.getElementById('searchInput');
        const resultsContainer = document.getElementById('resultsContainer');
        const defaultContainer = document.getElementById('defaultContainer');
        const suggestionBox = document.getElementById('suggestionBox');
        const suggestionText = document.getElementById('suggestionText');
        const officeListContainer = document.getElementById('officeList');
        const emptyStateIcon = document.getElementById('emptyStateIcon');

        window.addEventListener('DOMContentLoaded', () => {
            renderOfficeList();
            lucide.createIcons();
            searchInput.addEventListener('input', handleSearch);
        });

        function handleSearch(e) {
            const rawTerm = e.target.value;
            const term = rawTerm.trim().replace('台', '臺');
            
            if (!term) {
                showDefaultView();
                return;
            }

            let results = [];
            const isDigitSearch = /^\d+$/.test(term);

            // 1. 行政區匹配
            offices.filter(o => o.areas.some(a => a.includes(term))).forEach(o => {
                const matchedArea = o.areas.find(a => a.includes(term));
                results.push({
                    office: o,
                    matchType: 'area',
                    matchName: matchedArea
                });
            });

            // 2. 地段/代碼匹配
            sectionDatabase.filter(s => isDigitSearch ? s.c.includes(term) : (s.n.includes(term) || (s.n + '段').includes(term)))
                .forEach(match => {
                    const office = offices.find(o => o.areas.includes(match.a));
                    if (office && !results.some(r => r.code === match.c)) {
                        results.push({
                            office: office,
                            matchType: 'section',
                            matchName: match.n + '段',
                            code: match.c,
                            relatedArea: match.a
                        });
                    }
                });

            // 3. 排序 (依據您的要求：數字左至右遞增，文字筆劃遞增)
            if (isDigitSearch) {
                results.sort((a, b) => (a.code || '').localeCompare(b.code || ''));
            } else {
                results.sort((a, b) => a.matchName.localeCompare(b.matchName, 'zh-Hant-TW'));
            }

            if (results.length > 0) {
                renderResults(results, isDigitSearch);
            } else {
                showDefaultView();
                showSuggestion('查無結果。請嘗試輸入正確的鄉鎮名或四位數地段代碼。');
            }
        }

        function setSearch(val) {
            searchInput.value = val;
            handleSearch({ target: { value: val } });
            // 自動捲動到結果處
            window.scrollTo({ top: searchInput.offsetTop - 20, behavior: 'smooth' });
        }

        function renderResults(results, isDigitSearch) {
            resultsContainer.classList.remove('hidden');
            defaultContainer.classList.add('hidden');
            resultsContainer.innerHTML = '';

            const countText = isDigitSearch ? `找到 <strong>${results.length}</strong> 筆代碼包含「${searchInput.value}」的地段。` : `找到 <strong>${results.length}</strong> 筆相符資料。`;
            resultsContainer.innerHTML = `
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg mb-6 shadow-sm">
                    <div class="flex items-center">
                        <i data-lucide="info" class="h-5 w-5 text-yellow-600 mr-2 shrink-0"></i>
                        <p class="text-sm text-yellow-700">${countText}</p>
                    </div>
                </div>
            `;

            results.forEach(result => {
                const card = document.createElement('div');
                card.className = "shadow-lg rounded-2xl overflow-hidden bg-white mb-6 border border-gray-100 transition-all hover:shadow-xl";
                
                let matchContent = '';
                if (result.matchType === 'area') {
                    matchContent = `您查詢的行政區為 <strong class="text-lg text-teal-800">${result.matchName}</strong>`;
                } else {
                    matchContent = `地段：<strong class="text-xl text-teal-800">${result.matchName}</strong> <br class="md:hidden"> <span class="hidden md:inline mx-2 text-gray-300">|</span> 代碼：<span class="bg-orange-100 text-orange-700 px-2 rounded font-mono font-bold">${result.code}</span> <br> 位於：<span class="text-gray-600 font-medium">${result.relatedArea}</span>`;
                }

                const areasHtml = result.office.areas.map(area => {
                    const isHighlight = area === result.matchName || area === result.relatedArea;
                    const classes = isHighlight ? 'bg-yellow-200 text-yellow-800 font-bold ring-1 ring-yellow-300' : 'text-gray-500 bg-gray-100';
                    return `<span class="text-xs px-2.5 py-1 rounded-md ${classes}">${area}</span>`;
                }).join('');

                card.innerHTML = `
                    <div class="p-5 text-white ${result.office.color} flex justify-between items-center">
                        <div>
                            <span class="text-[10px] uppercase tracking-[0.2em] opacity-80 font-bold">管轄單位</span>
                            <h2 class="text-xl md:text-2xl font-bold">${result.office.name}</h2>
                        </div>
                        <i data-lucide="landmark" class="w-8 h-8 opacity-40"></i>
                    </div>
                    
                    <div class="p-5 md:p-8">
                        <div class="mb-6 ${result.office.lightColor} border-l-4 ${result.office.borderColor} p-4 rounded-r-xl shadow-inner">
                            <p class="text-sm md:text-base text-gray-800 leading-relaxed">${matchContent}</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div class="flex items-start">
                                <div class="bg-gray-100 p-2 rounded-lg mr-4">
                                    <i data-lucide="map-pin" class="w-5 h-5 text-gray-500"></i>
                                </div>
                                <div>
                                    <p class="text-[10px] text-gray-400 font-bold uppercase mb-0.5">服務地址</p>
                                    <p class="text-sm text-gray-800 font-medium">${result.office.address}</p>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="bg-gray-100 p-2 rounded-lg mr-4">
                                    <i data-lucide="phone" class="w-5 h-5 text-gray-500"></i>
                                </div>
                                <div>
                                    <p class="text-[10px] text-gray-400 font-bold uppercase mb-0.5">聯絡電話</p>
                                    <a href="tel:${result.office.phone}" class="text-teal-600 font-bold hover:underline text-lg decoration-2 underline-offset-4">${result.office.phone}</a>
                                </div>
                            </div>
                        </div>

                        <div class="mb-8">
                            <div class="flex items-center mb-3">
                                <i data-lucide="layers" class="w-4 h-4 text-gray-400 mr-2"></i>
                                <p class="text-[10px] text-gray-400 font-bold uppercase">該所完整轄區</p>
                            </div>
                            <div class="flex flex-wrap gap-2">${areasHtml}</div>
                        </div>

                        <div class="flex flex-col sm:flex-row gap-3">
                            <a href="${result.office.mapLink}" target="_blank" class="flex-1 bg-teal-600 text-white py-3.5 px-4 rounded-xl text-center font-bold hover:bg-teal-700 transition flex items-center justify-center gap-2 active:scale-95">
                                <i data-lucide="navigation" class="w-4 h-4"></i> 導航前往
                            </a>
                            <a href="${result.office.website}" target="_blank" class="flex-1 bg-white border-2 border-gray-200 text-gray-700 py-3.5 px-4 rounded-xl text-center font-bold hover:border-gray-300 hover:bg-gray-50 transition flex items-center justify-center gap-2 active:scale-95">
                                <i data-lucide="external-link" class="w-4 h-4"></i> 官方網站
                            </a>
                        </div>
                    </div>
                `;
                resultsContainer.appendChild(card);
            });
            lucide.createIcons();
        }

        function showDefaultView() {
            resultsContainer.classList.add('hidden');
            defaultContainer.classList.remove('hidden');
            suggestionBox.classList.add('hidden');
            emptyStateIcon.classList.remove('hidden');
        }

        function showSuggestion(msg) {
            suggestionText.textContent = msg;
            suggestionBox.classList.remove('hidden');
            emptyStateIcon.classList.add('hidden');
        }

        function renderOfficeList() {
            officeListContainer.innerHTML = offices.map(o => `
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition">
                    <div class="text-[10px] font-black px-2 py-1 text-white rounded-md w-fit mb-3 ${o.color}">
                        ${o.name}
                    </div>
                    <div class="flex flex-wrap gap-1.5">
                        ${o.areas.map(area => `
                            <span class="text-xs bg-gray-50 text-gray-600 px-2 py-1 rounded border border-gray-100">${area}</span>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
